<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Williamdes&#x27;s blog - Setup Debian sbuild chroots</title>

        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">

        <!-- Enable responsiveness on mobile devices-->
        <!-- viewport-fit=cover is to support iPhone X rounded corners and notch in landscape-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

        <!-- Standard meta tags -->
        <meta name="author" content="William Desportes">
        <meta name="description" content="Creating sbuild chroots for Debian package testing">

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@wdesportes" />
        <meta name="twitter:creator" content="@wdesportes" />

        <!-- Open Graph Tags -->
        <meta property="og:locale" content="en_US" />
        <meta property="og:site_name" content="Williamdes's blog">
        
        <meta property="og:title" content="Setup Debian sbuild chroots">
        <meta property="og:url" content="https://blog.williamdes.eu/Debian/manuals/create-debian-sbuild-chroots">
        <meta property="og:description" content="Creating sbuild chroots for Debian package testing">
        
        <meta property="og:type" content="article">
        <meta name="publish_date" property="og:publish_date" content="2023-01-18T12:40:00+00:05">
        <meta property="article:published_time" content="2023-01-18T12:40:00">
        <meta property="article:modified_time" content="2025-02-01T17:14:00">
        <meta property="article:author" content="https://williamdes.eu">
        <meta property="article:tags" content="debian-manual"><meta property="article:tags" content="sbuild">
        

        <!-- CSS -->
        <link rel="stylesheet" href="https://blog.williamdes.eu/main.css">

        <!-- Feeds -->
        <link rel="alternate" type="application/atom+xml" title="RSS" href="https://blog.williamdes.eu/atom.xml">




    
    

    
    

    
    

<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement":
        [
            {
                "@type": "ListItem",
                "position": 1,
                "item": {
                    "@id": "https://blog.williamdes.eu",
                    "name": "Williamdes's blog"
                }
            },
            {
                "@type": "ListItem",
                "position": 2,
                "item": {
                    "@id": "https://blog.williamdes.eu/Debian",
                    "name": "Debian"
                }
            },
            {
                "@type": "ListItem",
                "position": 3,
                "item": {
                    "@id": "https://blog.williamdes.eu/Debian/manuals",
                    "name": "manuals"
                }
            },
            {
                "@type": "ListItem",
                "position": 4,
                "item": {
                    "@id": "https://blog.williamdes.eu/Debian/manuals/create-debian-sbuild-chroots",
                    "name": "Setup Debian sbuild chroots"
                }
            }
        ]
    }
</script>
<script type="application/ld+json">
{
    "@context":"http://schema.org",
    "@type": "BlogPosting",
    
    
    "url": "https://blog.williamdes.eu/Debian/manuals/create-debian-sbuild-chroots/",
    "headline": "Setup Debian sbuild chroots",
    "alternativeHeadline": "Setup Debian sbuild chroots",
    "dateCreated": "2023-01-18T12:40:00+0005",
    "datePublished": "2023-01-18T12:40:00+0005",
    "dateModified": "2025-02-01T17:14:00+0001",
    "inLanguage": "en",
    "isFamilyFriendly": "true",
    "author": {
        "@type": "Person",
        "name": "William Desportes",
        "url": "https://williamdes.eu"
    },
    "mainEntityOfPage": "True",
    "keywords": ["debian-manual","sbuild"],
    "articleSection": "Manual",
    "genre": ["debian-manual","sbuild"]
}
</script>
<!-- Matomo -->
        <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="https://analytics.wdes.eu/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '1']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
        })();
        </script>
        <noscript><p><img src="https://analytics.wdes.eu/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt="" /></p></noscript>
        <!-- End Matomo Code -->
    </head>

    <body class="single">

    
        <header class="header">
            <nav class="nav">
                
                <p class="logo"><a href="https://blog.williamdes.eu">Williamdes&#x27;s blog</a></p>
                
                <ul class="menu">
                    
                </ul>
            </nav>
        </header>

        <main class="main">
            
<article class="post-single">
    <header class="post-header">
        <h1 class="post-title">Setup Debian sbuild chroots</h1>
        
        <div class="post-meta">
            Author: <a class="post-author" href="https://williamdes.eu">
                William Desportes
            </a>
            
            <br/>
            <span class="post-date">Published: <time datetime="2023-01-18T12:40:00+0005">January 18, 2023 12:40</time></span>
            <span class="post-date"> and updated: <time datetime="2025-02-01T17:14:00+0001">February  1, 2025 17:14</time></span>
            <span>&middot;</span>
            <span class="post-reading-time">3 min read</span>
        </div>
    </header>
    <div class="post-content"><p>Creating <a rel="noopener" target="_blank" href="https://wiki.debian.org/sbuild">sbuild</a> chroots for Debian package testing</p>
<span id="continue-reading"></span>
<p>This is how to setup sbuild chroots for Debian packaging.</p>
<p>The <a rel="noopener" target="_blank" href="https://wiki.debian.org/sbuild">Debian wiki</a> explains this already pretty good.</p>
<p>But here is how I use and setup my chroots.</p>
<h2 id="what-is-a-chroot">What is a chroot</h2>
<p>From what I understood its like some kind of "VM" that uses the host Kernel, this is named a "chroot".
But that's not really that is more like an environment where the OS root directory "/" is reset to some folder on you system.
But for some reason I noticed they affect your host filesystem.</p>
<p>You can read more about it on <a rel="noopener" target="_blank" href="https://wiki.debian.org/chroot">Debian wiki</a> <a rel="noopener" target="_blank" href="https://wiki.debian.org/fr/Chroot">fr</a> and on <a rel="noopener" target="_blank" href="https://wikipedia.org/wiki/Chroot">Wikipedia</a></p>
<h2 id="setup-the-chroots">Setup the chroots</h2>
<p>If you have an SSD and some useless RAM, you can use tmpfs to hold some files and avoid SSD writes: <a rel="noopener" target="_blank" href="https://wiki.debian.org/sbuild#sbuild_with_tmpfs_.28schroot.29">Debian wiki</a></p>
<h2 id="share-apt-cache-across-chroots">Share APT cache across chroots</h2>
<p>It takes less bandwith, you can skip this if this is not an issue for you.</p>
<p>This mounting technique is described on <a rel="noopener" target="_blank" href="https://wiki.ubuntu.com/SimpleSbuild">Ubuntu wiki</a>.</p>
<h3 id="apt-archives-cache">APT archives cache</h3>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">mkdir</span><span> /var/lib/sbuild/apt-cache
</span><span style="color:#bf616a;">sudo</span><span> chown sbuild:sbuild /var/lib/sbuild/apt-cache
</span></code></pre>
<p>In <code>/etc/schroot/sbuild/fstab</code>, add:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>/var/lib/sbuild/apt-cache  /var/cache/apt/archives  none    rw,bind 0   0
</span></code></pre>
<p>Run a sbuild, and check that /var/lib/sbuild/apt-cache has new files or folders</p>
<h3 id="add-your-user-to-the-sbuild-group">Add your user to the sbuild group</h3>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">sudo</span><span> sbuild-adduser williamdes
</span><span style="color:#bf616a;">newgrp</span><span> sbuild
</span><span style="color:#65737e;"># Check (or use: id)
</span><span style="color:#bf616a;">groups
</span></code></pre>
<h3 id="sid-chroot">Sid chroot</h3>
<p>You can add more packages to <code>--include</code>.
The packages will not be used for DEP-8 autopkgtests, check the "Autopkgtests" section of this blog post.</p>
<p>For example: <code>--include eatmydata,ccache,lintian,pkg-php-tools,phpunit,phpab,php-cgi,php-cli,lighttpd,chromium,chromium-driver,python3-selenium</code></p>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">INCLUDED_PACKAGES</span><span>=</span><span style="color:#a3be8c;">eatmydata,ccache </span><span>\
</span><span style="color:#bf616a;">sudo</span><span> sbuild-createchroot \
</span><span style="color:#bf616a;">    --extra-repository</span><span>=&#39;</span><span style="color:#a3be8c;">deb http://incoming.debian.org/debian-buildd/ buildd-unstable main</span><span>&#39; \
</span><span style="color:#bf616a;">    --extra-repository</span><span>=&#39;</span><span style="color:#a3be8c;">deb http://incoming.debian.org/debian-buildd/ buildd-sid main</span><span>&#39; \
</span><span style="color:#bf616a;">    --alias</span><span>=sid</span><span style="color:#bf616a;"> --alias</span><span>=UNRELEASED</span><span style="color:#bf616a;"> --chroot-prefix</span><span>=sid \
</span><span style="color:#bf616a;">    --include</span><span>=$</span><span style="color:#bf616a;">INCLUDED_PACKAGES </span><span>\
</span><span>    sid /srv/chroot/sid-amd64-sbuild http://ftp.fr.debian.org/debian
</span></code></pre>
<p>Run the sbuild chroot: <code>sbuild -c sid</code></p>
<h4 id="update-the-sid-chroot">Update the sid chroot</h4>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">sudo</span><span> sbuild-shell source:sid-amd64-sbuild
</span><span style="color:#bf616a;">apt</span><span> update
</span><span style="color:#bf616a;">apt</span><span> upgrade</span><span style="color:#bf616a;"> -y
</span><span style="color:#96b5b4;">exit
</span></code></pre>
<p>Or: <code>sudo sbuild-update -ugd sid</code></p>
<h3 id="normal-chroot">Normal chroot</h3>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">sudo</span><span> sbuild-createchroot</span><span style="color:#bf616a;"> --alias</span><span>=bookworm</span><span style="color:#bf616a;"> --chroot-prefix</span><span>=bookworm</span><span style="color:#bf616a;"> --include</span><span>=eatmydata,ccache bookworm /srv/chroot/bookworm-amd64-sbuild http://ftp.fr.debian.org/debian
</span></code></pre>
<p>Run the chroot: <code>sbuild -c bookworm</code></p>
<h3 id="experimental-chroot">Experimental chroot</h3>
<p>Create the chroot:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">sudo</span><span> sbuild-createchroot</span><span style="color:#bf616a;"> --chroot-prefix</span><span>=experimental</span><span style="color:#bf616a;"> --extra-repository</span><span>=&#39;</span><span style="color:#a3be8c;">deb http://deb.debian.org/debian experimental main</span><span>&#39;</span><span style="color:#bf616a;"> --include</span><span>=eatmydata,ccache bookworm /srv/chroot/experimental-amd64-sbuild http://ftp.fr.debian.org/debian
</span></code></pre>
<p>Make sure the packages in backports are preferred above the original ones:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">sudo</span><span> sbuild-shell source:experimental-amd64-sbuild
</span><span style="color:#96b5b4;">echo </span><span>&quot;</span><span style="color:#a3be8c;">Package: *\nPin: release a=experimental\nPin-Priority:900</span><span>&quot; &gt; /etc/apt/preferences.d/experimental.pref
</span><span style="color:#96b5b4;">exit
</span></code></pre>
<h3 id="backports-chroot">Backports chroot</h3>
<p>Create the chroot:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">sudo</span><span> sbuild-createchroot \
</span><span style="color:#bf616a;">    --chroot-prefix</span><span>=bookworm-backports \
</span><span style="color:#bf616a;">    --extra-repository</span><span>=&#39;</span><span style="color:#a3be8c;">deb http://deb.debian.org/debian bookworm-backports main</span><span>&#39; \
</span><span style="color:#bf616a;">    --include</span><span> eatmydata,ccache,lintian,pkg-php-tools,phpunit,phpab,php-cgi,php-cli \
</span><span>    bookworm /srv/chroot/bookworm-backports-amd64-sbuild http://ftp.fr.debian.org/debian
</span></code></pre>
<p>Make sure the packages in backports are preferred above the original ones:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">sudo</span><span> sbuild-shell source:bookworm-backports-amd64-sbuild
</span><span style="color:#96b5b4;">echo </span><span>&quot;</span><span style="color:#a3be8c;">Package: *\nPin: release a=bookworm-backports\nPin-Priority:900</span><span>&quot; &gt; /etc/apt/preferences.d/bookworm-backports.pref
</span><span style="color:#65737e;"># Update the chroot
</span><span style="color:#bf616a;">apt</span><span> update
</span><span style="color:#bf616a;">apt</span><span> upgrade
</span><span style="color:#96b5b4;">exit
</span></code></pre>
<h4 id="early-backports-testing">Early backports testing</h4>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">sbuild -d</span><span> bookworm-backports</span><span style="color:#bf616a;"> --extra-repository</span><span>=&#39;</span><span style="color:#a3be8c;">deb http://incoming.debian.org/debian-buildd/ buildd-bookworm-backports main</span><span>&#39;
</span></code></pre>
<p>More about this on this <a rel="noopener" target="_blank" href="https://aerostitch.github.io/linux_and_unix/debian/sbuild_with_experimental_distribution.html">blog post</a></p>
<h4 id="ubuntu-focal-chroot">Ubuntu focal chroot</h4>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">sudo</span><span> sbuild-createchroot \
</span><span style="color:#bf616a;">    --extra-repository</span><span>=&#39;</span><span style="color:#a3be8c;">deb http://security.ubuntu.com/ubuntu focal-security main restricted universe multiverse</span><span>&#39; \
</span><span style="color:#bf616a;">    --extra-repository</span><span>=&#39;</span><span style="color:#a3be8c;">deb http://archive.ubuntu.com/ubuntu/ focal-updates main restricted universe multiverse</span><span>&#39; \
</span><span style="color:#bf616a;">    --alias</span><span>=focal</span><span style="color:#bf616a;"> --chroot-prefix</span><span>=focal</span><span style="color:#bf616a;"> --include</span><span>=eatmydata,ccache \
</span><span style="color:#bf616a;">    --components</span><span> main,restricted,universe,multiverse \
</span><span>    focal /srv/chroot/focal-amd64-sbuild http://archive.ubuntu.com/ubuntu/
</span></code></pre>
<h2 id="use-the-chroots">Use the chroots</h2>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#96b5b4;">cd</span><span> /home/user/packages/my-package
</span><span style="color:#65737e;"># sid dist
</span><span style="color:#bf616a;">sbuild -d</span><span> sid
</span><span style="color:#65737e;"># Normal dist
</span><span style="color:#bf616a;">sbuild -d</span><span> bookworm
</span><span style="color:#65737e;"># Backports dist
</span><span style="color:#bf616a;">sbuild -d</span><span> bookworm-backports
</span></code></pre>
<h3 id="list-chroots">List chroots</h3>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">schroot -l
</span></code></pre>
<h3 id="remove-a-chroot">Remove a chroot</h3>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#65737e;"># Also check: /srv/sbuild/qemu/
</span><span style="color:#bf616a;">rm -r</span><span> /srv/chroot/experimental-amd64-sbuild
</span><span style="color:#65737e;"># Find config the file and remove it
</span><span style="color:#bf616a;">rm</span><span> /etc/schroot/chroot.d/experimental-amd64-sbuild-F28TrU
</span><span style="color:#bf616a;">rm</span><span> /etc/sbuild/chroot/experimental-amd64-sbuild
</span></code></pre>
<h2 id="install-a-qemu-chroot">Install a qemu chroot</h2>
<p>This is a more like a real VM.
I found some inspiration on this <a rel="noopener" target="_blank" href="https://anarc.at/blog/2022-04-27-sbuild-qemu/">blog post from anarc.at</a>.</p>
<h3 id="install">Install</h3>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">apt</span><span> install sbuild-qemu
</span></code></pre>
<h3 id="use-qemu-by-default">Use qemu by default</h3>
<p>In <code>~/.sbuildrc</code> add this before the end</p>
<pre data-lang="perl" style="background-color:#2b303b;color:#c0c5ce;" class="language-perl "><code class="language-perl" data-lang="perl"><span style="color:#65737e;"># extra parameters to pass to qemu
</span><span style="color:#65737e;"># --enable-kvm is not necessary, detected on the fly by autopkgtest
</span><span style="color:#65737e;">#
</span><span style="color:#65737e;"># ! Adjust this performance settings !
</span><span style="color:#65737e;">#
</span><span style="color:#65737e;"># 4096 of RAM, 2 CPUs
</span><span style="color:#b48ead;">my </span><span>@</span><span style="color:#bf616a;">_qemu_options </span><span>= (&#39;</span><span style="color:#a3be8c;">--ram-size=4096</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">--cpus=4</span><span>&#39;);
</span><span>
</span><span style="color:#65737e;"># run autopkgtest inside the schroot
</span><span>$</span><span style="color:#bf616a;">run_autopkgtest </span><span>= </span><span style="color:#d08770;">1</span><span>;
</span><span style="color:#65737e;"># tell sbuild to use autopkgtest as a chroot
</span><span>$</span><span style="color:#bf616a;">chroot_mode </span><span>= &#39;</span><span style="color:#a3be8c;">autopkgtest</span><span>&#39;;
</span><span style="color:#65737e;"># tell autopkgtest to use qemu
</span><span>$</span><span style="color:#bf616a;">autopkgtest_virt_server </span><span>= &#39;</span><span style="color:#a3be8c;">qemu</span><span>&#39;;
</span><span style="color:#65737e;"># tell autopkgtest-virt-qemu the path to the image
</span><span style="color:#65737e;"># use --debug there to show what autopkgtest is doing
</span><span>$</span><span style="color:#bf616a;">autopkgtest_virt_server_options </span><span>= [ @</span><span style="color:#bf616a;">_qemu_options</span><span>, &#39;</span><span style="color:#a3be8c;">--</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">/srv/sbuild/qemu/%r-autopkgtest-</span><span style="color:#d08770;">%a</span><span style="color:#a3be8c;">.img</span><span>&#39; ];
</span><span style="color:#65737e;"># tell plain autopkgtest to use qemu, and the right image
</span><span>$</span><span style="color:#bf616a;">autopkgtest_opts </span><span>= [ &#39;</span><span style="color:#a3be8c;">--</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">qemu</span><span>&#39;, @</span><span style="color:#bf616a;">_qemu_options</span><span>, &#39;</span><span style="color:#a3be8c;">/srv/sbuild/qemu/%r-autopkgtest-</span><span style="color:#d08770;">%a</span><span style="color:#a3be8c;">.img</span><span>&#39;];
</span><span style="color:#65737e;"># no need to cleanup the chroot after build, we run in a completely clean VM
</span><span>$</span><span style="color:#bf616a;">purge_build_deps </span><span>= &#39;</span><span style="color:#a3be8c;">never</span><span>&#39;;
</span><span style="color:#65737e;"># no need for sudo
</span><span>$</span><span style="color:#bf616a;">autopkgtest_root_args </span><span>= &#39;&#39;;
</span><span>
</span><span style="color:#65737e;"># Lintian config
</span><span style="color:#65737e;"># Display info and pedantic tags.
</span><span style="color:#65737e;"># You can add &#39;--suppress-tags&#39;, &#39;inconsistent-maintainer,unreleased-changes,changelog-distribution-does-not-match-changes-file,missing-pkg-php-tools-addon&#39;
</span><span>$</span><span style="color:#bf616a;">lintian_opts </span><span>= [&#39;</span><span style="color:#a3be8c;">--display-info</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">--verbose</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">--fail-on</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">error,warning</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">--info</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">--pedantic</span><span>&#39;];
</span></code></pre>
<h3 id="create-a-bookworm-sbuild">Create a bookworm sbuild</h3>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">mkdir -p</span><span> /srv/sbuild/qemu/
</span><span style="color:#bf616a;">sbuild-qemu-create --install-packages</span><span> build-essential,debhelper</span><span style="color:#bf616a;"> -o</span><span> /srv/sbuild/qemu/testing-autopkgtest-amd64.img testing http://ftp.fr.debian.org/debian
</span><span style="color:#bf616a;">sudo</span><span> chown root:sbuild  /srv/sbuild/qemu/testing-autopkgtest-amd64.img
</span></code></pre>
<h3 id="autopkgtests">Autopkgtests</h3>
<h4 id="create-a-sid-sbuild">Create a sid sbuild</h4>
<p>You can install more packages, for example: <code>--install-packages build-essential,debhelper,fakeroot,lintian,pkg-php-tools,phpunit,phpab,php-cgi,php-cli,lighttpd,chromium,chromium-driver,python3-selenium</code></p>
<p>If you change <code>sid</code> by <code>unstable</code> it will be a unstable sbuild.</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">mkdir -p</span><span> /srv/sbuild/qemu/
</span><span style="color:#b48ead;">export </span><span style="color:#bf616a;">DIST</span><span>=</span><span style="color:#a3be8c;">unstable</span><span>;
</span><span style="color:#b48ead;">export </span><span style="color:#bf616a;">INCLUDED_PACKAGES</span><span>=</span><span style="color:#a3be8c;">build-essential,debhelper,fakeroot,lintian,pkg-php-tools,phpunit,phpab,php-cgi,php-cli,lighttpd,chromium,chromium-driver,python3-selenium</span><span>;
</span><span>
</span><span style="color:#bf616a;">sudo</span><span> sbuild-qemu-create \
</span><span style="color:#bf616a;">    --install-packages </span><span>$</span><span style="color:#bf616a;">INCLUDED_PACKAGES </span><span>\
</span><span style="color:#bf616a;">    -o</span><span> /srv/sbuild/qemu/$</span><span style="color:#bf616a;">DIST</span><span>-autopkgtest-amd64.img \
</span><span>    $</span><span style="color:#bf616a;">DIST</span><span> http://ftp.fr.debian.org/debian
</span><span>
</span><span style="color:#bf616a;">sudo</span><span> chown root:sbuild  /srv/sbuild/qemu/$</span><span style="color:#bf616a;">DIST</span><span>-autopkgtest-amd64.img
</span></code></pre>
<p>Run the sbuild VM: <code>sbuild -d sid</code>, or to run and skip Lintian: <code>sbuild -d sid --no-run-lintian</code></p>
<h5 id="update-the-sid-vm">Update the sid VM</h5>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">sudo</span><span> sbuild-qemu-update /srv/sbuild/qemu/sid-autopkgtest-amd64.img
</span></code></pre>
<h6 id="run-commands-in-the-vm">Run commands in the VM</h6>
<h6 id="forget-my-changes">Forget my changes</h6>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">sbuild-qemu-boot</span><span> /srv/sbuild/qemu/sid-autopkgtest-amd64.img
</span></code></pre>
<h6 id="keep-my-changes">Keep my changes</h6>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">sbuild-qemu-boot --read-write</span><span> /srv/sbuild/qemu/sid-autopkgtest-amd64.img
</span></code></pre>
</div>
    <footer class="post-footer">
        
        <ul class="post-tags">
        
            <li><a href="https://blog.williamdes.eu/tags/debian-manual/">debian-manual</a></li>
        
            <li><a href="https://blog.williamdes.eu/tags/sbuild/">sbuild</a></li>
        
        </ul>
        
    </footer>
</article>

        </main>

        <footer class="footer">
            <span>&copy; 2021-2025 <a href="https://blog.williamdes.eu">Williamdes&#x27;s blog</a></span>
            <span>&middot;</span>
            <span>Powered by <a href="https://www.getzola.org" rel="noopener" target="_blank">Zola</a></span>
            <span>&middot;</span>
            <span>Theme <a href="https://github.com/schoenenberg/zola-paper" rel="noopener" target="_blank">Zola-Paper</a></span>
            <br>
            <span><a href="https://github.com/wdesportes/blog.williamdes.eu" rel="noopener" target="_blank">Source code on GitHub</a></span>
            <span>&middot;</span>
            <span><a href="https://github.com/wdesportes/blog.williamdes.eu/discussions" rel="noopener" target="_blank">Found a bug ?</a></span>
            <span>&middot;</span>
            <span><a href="https://williamdes.eu" rel="noopener" target="_blank">Visit my personal website</a></span>
            <span>&middot;</span>
            <span><a href="https://blog.williamdes.eu/atom.xml" rel="noopener" target="_blank" type="application/rss+xml">RSS feed</a></span>
            <br>
            <span>If you are searching for cookies, this is not a bakery website ^^</span>
        </footer>
    
    </body>
</html>
