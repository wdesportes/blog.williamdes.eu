<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Williamdes&#x27;s blog - How to write a plugin&#x2F;handler&#x2F;pipeline for mailman3 to add&#x2F;edit&#x2F;remove headers of posts</title>

        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">

        <!-- Enable responsiveness on mobile devices-->
        <!-- viewport-fit=cover is to support iPhone X rounded corners and notch in landscape-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

        <!-- Standard meta tags -->
        <meta name="author" content="William Desportes">
        <meta name="description" content="How to write a plugin&#x2F;handler&#x2F;pipeline for mailman3 to add&#x2F;edit&#x2F;remove headers of posts">

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@wdesportes" />
        <meta name="twitter:creator" content="@wdesportes" />

        <!-- Open Graph Tags -->
        <meta property="og:locale" content="en_US" />
        <meta property="og:site_name" content="Williamdes's blog">
        
        <meta property="og:title" content="How to write a plugin&#x2F;handler&#x2F;pipeline for mailman3 to add&#x2F;edit&#x2F;remove headers of posts">
        <meta property="og:url" content="https://blog.williamdes.eu/Infrastructure/tutorials/add-a-sender-header-to-mailman-3-posts">
        <meta property="og:description" content="How to write a plugin&#x2F;handler&#x2F;pipeline for mailman3 to add&#x2F;edit&#x2F;remove headers of posts">
        
        <meta property="og:type" content="article">
        <meta name="publish_date" property="og:publish_date" content="2025-01-05T19:41:00+00:01">
        <meta property="article:published_time" content="2025-01-05T19:41:00">
        <meta property="article:modified_time" content="2025-01-05T20:22:00">
        <meta property="article:author" content="https://williamdes.eu">
        <meta property="article:tags" content="infra-tutorial"><meta property="article:tags" content="mailman3">
        

        <!-- CSS -->
        <link rel="stylesheet" href="https://blog.williamdes.eu/main.css">

        <!-- Feeds -->
        <link rel="alternate" type="application/atom+xml" title="RSS" href="https://blog.williamdes.eu/atom.xml">




    
    

    
    

    
    

<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement":
        [
            {
                "@type": "ListItem",
                "position": 1,
                "item": {
                    "@id": "https://blog.williamdes.eu",
                    "name": "Williamdes's blog"
                }
            },
            {
                "@type": "ListItem",
                "position": 2,
                "item": {
                    "@id": "https://blog.williamdes.eu/Infrastructure",
                    "name": "Infrastructure"
                }
            },
            {
                "@type": "ListItem",
                "position": 3,
                "item": {
                    "@id": "https://blog.williamdes.eu/Infrastructure/tutorials",
                    "name": "tutorials"
                }
            },
            {
                "@type": "ListItem",
                "position": 4,
                "item": {
                    "@id": "https://blog.williamdes.eu/Infrastructure/tutorials/add-a-sender-header-to-mailman-3-posts",
                    "name": "How to write a plugin/handler/pipeline for mailman3 to add/edit/remove headers of posts"
                }
            }
        ]
    }
</script>
<script type="application/ld+json">
{
    "@context":"http://schema.org",
    "@type": "BlogPosting",
    
    
    "url": "https://blog.williamdes.eu/Infrastructure/tutorials/add-a-sender-header-to-mailman-3-posts/",
    "headline": "How to write a plugin&#x2F;handler&#x2F;pipeline for mailman3 to add&#x2F;edit&#x2F;remove headers of posts",
    "alternativeHeadline": "How to write a plugin&#x2F;handler&#x2F;pipeline for mailman3 to add&#x2F;edit&#x2F;remove headers of posts",
    "dateCreated": "2025-01-05T19:41:00+0001",
    "datePublished": "2025-01-05T19:41:00+0001",
    "dateModified": "2025-01-05T20:22:00+0001",
    "inLanguage": "en",
    "isFamilyFriendly": "true",
    "author": {
        "@type": "Person",
        "name": "William Desportes",
        "url": "https://williamdes.eu"
    },
    "mainEntityOfPage": "True",
    "keywords": ["mailman3","plugin","handler","headers"],
    "articleSection": "Tutorial",
    "genre": ["infra-tutorial","mailman3"]
}
</script>
<!-- Matomo -->
        <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="https://analytics.wdes.eu/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '1']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
        })();
        </script>
        <noscript><p><img src="https://analytics.wdes.eu/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt="" /></p></noscript>
        <!-- End Matomo Code -->
    </head>

    <body class="single">

    
        <header class="header">
            <nav class="nav">
                
                <p class="logo"><a href="https://blog.williamdes.eu">Williamdes&#x27;s blog</a></p>
                
                <ul class="menu">
                    
                </ul>
            </nav>
        </header>

        <main class="main">
            
<article class="post-single">
    <header class="post-header">
        <h1 class="post-title">How to write a plugin&#x2F;handler&#x2F;pipeline for mailman3 to add&#x2F;edit&#x2F;remove headers of posts</h1>
        
        <div class="post-meta">
            Author: <a class="post-author" href="https://williamdes.eu">
                William Desportes
            </a>
            
            <br/>
            <span class="post-date">Published: <time datetime="2025-01-05T19:41:00+0001">January  5, 2025 19:41</time></span>
            <span class="post-date"> and updated: <time datetime="2025-01-05T20:22:00+0001">January  5, 2025 20:22</time></span>
            <span>&middot;</span>
            <span class="post-reading-time">5 min read</span>
        </div>
    </header>
    <div class="post-content"><p>How to write a plugin/handler/pipeline for mailman3 to add/edit/remove headers of posts</p>
<span id="continue-reading"></span>
<p>In this blog post I will show you how to write a plugin that edits the headers of received mailing list posts.</p>
<p>Tested on Debian 12 with mailman3: <code>3.3.8-2~deb12u2</code>.</p>
<h2 id="configuring-the-plugin-in-mailman">Configuring the plugin in mailman</h2>
<p>In <code>/etc/mailman3/mailman.cfg</code> you will need to add</p>
<pre data-lang="ini" style="background-color:#2b303b;color:#c0c5ce;" class="language-ini "><code class="language-ini" data-lang="ini"><span style="color:#b48ead;">[plugin.mailman_sender_plugin]
</span><span style="color:#65737e;"># The file will be at: /usr/lib/python3/dist-packages/mailman_sender_plugin/plugin.py
</span><span style="color:#65737e;"># And it needs a class named `SenderHeaderPlugin` that implements `IPlugin`.
</span><span style="color:#bf616a;">class</span><span>: mailman_sender_plugin.plugin.SenderHeaderPlugin
</span><span style="color:#bf616a;">enabled</span><span>: </span><span style="color:#d08770;">yes
</span><span style="color:#65737e;"># If you need a config file for the plugin, see: https://github.com/TIM-JYU/mailman-rest-events
</span><span style="color:#65737e;"># configuration: /etc/mailman3/mailman-sender-plugin.cfg
</span></code></pre>
<h2 id="creating-the-files-and-folders">Creating the files and folders</h2>
<p>Create a new folder for your package: <code>/usr/lib/python3/dist-packages/mailman_sender_plugin</code>.</p>
<p>The structure will be:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>/usr/lib/python3/dist-packages/mailman_sender_plugin
</span><span>├── handlers
</span><span>│   ├── handlers.py
</span><span>│   └── __init__.py
</span><span>├── pipelines
</span><span>│   ├── __init__.py
</span><span>│   └── pipelines.py
</span><span>├── __init__.py
</span><span>└── plugin.py
</span><span>
</span><span>3 directories, 6 files
</span></code></pre>
<h3 id="init-py-files"><code>__init__.py</code> files</h3>
<p>Files to create:</p>
<ul>
<li><code>__init__.py</code></li>
<li><code>handlers/__init__.py</code></li>
<li><code>pipelines/__init__.py</code></li>
</ul>
<p>Each <code>__init__.py</code> can be empty or have the contents:</p>
<pre data-lang="py" style="background-color:#2b303b;color:#c0c5ce;" class="language-py "><code class="language-py" data-lang="py"><span style="color:#65737e;"># This file is required to make the directory a Python package.
</span><span style="color:#65737e;"># It can remain empty.
</span></code></pre>
<h3 id="plugin-py"><code>plugin.py</code></h3>
<p>The <code>plugin.py</code> file has methods that do nothing:</p>
<pre data-lang="py" style="background-color:#2b303b;color:#c0c5ce;" class="language-py "><code class="language-py" data-lang="py"><span style="color:#b48ead;">from </span><span>public </span><span style="color:#b48ead;">import </span><span>public
</span><span style="color:#b48ead;">from </span><span>zope.interface </span><span style="color:#b48ead;">import </span><span>implementer
</span><span style="color:#b48ead;">from </span><span>mailman.interfaces.plugin </span><span style="color:#b48ead;">import </span><span>IPlugin
</span><span>
</span><span>@</span><span style="color:#bf616a;">public
</span><span>@</span><span style="color:#bf616a;">implementer</span><span>(IPlugin)
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">SenderHeaderPlugin</span><span style="color:#eff1f5;">:
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">pre_hook</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#b48ead;">pass
</span><span>
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">post_hook</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#b48ead;">pass
</span><span>
</span><span>    @</span><span style="color:#96b5b4;">property
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">resource</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">None
</span></code></pre>
<h3 id="pipelines-pipelines-py"><code>pipelines/pipelines.py</code></h3>
<p>The <code>plugin.py</code> file has methods that do nothing:</p>
<pre data-lang="py" style="background-color:#2b303b;color:#c0c5ce;" class="language-py "><code class="language-py" data-lang="py"><span style="color:#b48ead;">from </span><span>public </span><span style="color:#b48ead;">import </span><span>public
</span><span style="color:#b48ead;">from </span><span>mailman.interfaces.pipeline </span><span style="color:#b48ead;">import </span><span>IPipeline
</span><span style="color:#b48ead;">from </span><span>mailman.pipelines.base </span><span style="color:#b48ead;">import </span><span>BasePipeline
</span><span style="color:#65737e;">#from mailman.pipelines.builtin import PostingPipeline
</span><span style="color:#b48ead;">from </span><span>zope.interface </span><span style="color:#b48ead;">import </span><span>implementer
</span><span>
</span><span style="color:#65737e;"># Pipelines are list of &quot;handlers&quot;
</span><span style="color:#65737e;"># https://docs.mailman3.org/projects/mailman/en/latest/src/mailman/handlers/docs/handlers.html
</span><span>
</span><span style="color:#65737e;"># The Pipelines has to be an implementation of the IPipeline inteface
</span><span style="color:#65737e;"># https://gitlab.com/mailman/mailman/-/blob/master/src/mailman/interfaces/pipeline.py#L63
</span><span>
</span><span style="color:#65737e;"># Here are some example of built-in pipelines that are used by default in Mailman.
</span><span style="color:#65737e;"># https://gitlab.com/mailman/mailman/-/blob/master/src/mailman/pipelines/builtin.py
</span><span>
</span><span>@</span><span style="color:#bf616a;">public
</span><span>@</span><span style="color:#bf616a;">implementer</span><span>(IPipeline)
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">MailSenderPipeline</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">BasePipeline</span><span style="color:#eff1f5;">):
</span><span>
</span><span>    </span><span style="color:#65737e;"># The name of the pipeline should be unique.
</span><span>    name = &#39;</span><span style="color:#a3be8c;">mail-sender-pipeline</span><span>&#39;
</span><span>
</span><span>    </span><span style="color:#65737e;"># Briefly describe the pipeline so it can be shown in web frontends to users when choosing a pipeline.
</span><span>    description = &#39;</span><span style="color:#a3be8c;">Add Sender header and modify headers pipeline</span><span>&#39;
</span><span>
</span><span>    </span><span style="color:#65737e;"># List of handlers, in the correct order, to be used for processing the email.
</span><span>    </span><span style="color:#65737e;"># See: https://gitlab.com/mailman/mailman/-/blob/master/src/mailman/pipelines/builtin.py
</span><span>    </span><span style="color:#65737e;"># You can add your handler at the end if the order is correct for your use case
</span><span>    </span><span style="color:#65737e;"># _default_handlers = PostingPipeline._default_handlers + (&#39;mailman-after-sent-handler&#39;)
</span><span>    _default_handlers = (
</span><span>        &#39;</span><span style="color:#a3be8c;">validate-authenticity</span><span>&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">mime-delete</span><span>&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">tagger</span><span>&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">member-recipients</span><span>&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">avoid-duplicates</span><span>&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">cleanse</span><span>&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">cleanse-dkim</span><span>&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">cook-headers</span><span>&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">subject-prefix</span><span>&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">rfc-2369</span><span>&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">to-archive</span><span>&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">to-digest</span><span>&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">to-usenet</span><span>&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">after-delivery</span><span>&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">acknowledge</span><span>&#39;,
</span><span>        </span><span style="color:#65737e;"># All decoration is now done in delivery.
</span><span>        </span><span style="color:#65737e;"># &#39;decorate&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">dmarc</span><span>&#39;,
</span><span>        </span><span style="color:#65737e;"># Message decoration in delivery can break an arc signature, so sign
</span><span>        </span><span style="color:#65737e;"># in delivery after decorating.
</span><span>        </span><span style="color:#65737e;"># &#39;arc-sign&#39;,
</span><span>        </span><span style="color:#65737e;"># Add the Sender header
</span><span>        &#39;</span><span style="color:#a3be8c;">mailman-sender-handler</span><span>&#39;,
</span><span>        &#39;</span><span style="color:#a3be8c;">mailman-headers-handler</span><span>&#39;,
</span><span>        </span><span style="color:#65737e;"># Send it
</span><span>        &#39;</span><span style="color:#a3be8c;">to-outgoing</span><span>&#39;,
</span><span>    )
</span></code></pre>
<h3 id="handlers-handlers-py"><code>handlers/handlers.py</code></h3>
<pre data-lang="py" style="background-color:#2b303b;color:#c0c5ce;" class="language-py "><code class="language-py" data-lang="py"><span style="color:#b48ead;">from </span><span>public </span><span style="color:#b48ead;">import </span><span>public
</span><span style="color:#b48ead;">from </span><span>zope.interface </span><span style="color:#b48ead;">import </span><span>implementer
</span><span style="color:#b48ead;">from </span><span>mailman.interfaces.handler </span><span style="color:#b48ead;">import </span><span>IHandler
</span><span>
</span><span style="color:#65737e;"># Use this in the process function: raise DiscardMessage(&#39;Message was discarded because ...&#39;)
</span><span style="color:#65737e;">#from mailman.interfaces.pipeline import (
</span><span style="color:#65737e;">#    DiscardMessage,
</span><span style="color:#65737e;">#    RejectMessage,
</span><span style="color:#65737e;">#)
</span><span>
</span><span style="color:#65737e;">#import logging
</span><span style="color:#65737e;">#elog = logging.getLogger(&quot;mailman.error&quot;)
</span><span style="color:#65737e;"># Use this for logging in functions
</span><span style="color:#65737e;">#elog.error(&#39;My error message&#39;)
</span><span>
</span><span>@</span><span style="color:#bf616a;">public
</span><span>@</span><span style="color:#bf616a;">implementer</span><span>(IHandler)
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">SenderHeaderHandler</span><span style="color:#eff1f5;">:
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;A handler to add the Sender header to each email.&quot;&quot;&quot;
</span><span>
</span><span>    </span><span style="color:#65737e;"># The name of the handler should be unique.
</span><span>    name = &#39;</span><span style="color:#a3be8c;">mailman-sender-handler</span><span>&#39;
</span><span>    description = &#39;</span><span style="color:#a3be8c;">Add the Sender header to emails.</span><span>&#39;
</span><span>
</span><span>    </span><span style="color:#65737e;"># Documentation for mlist can be found here: https://docs.mailman3.org/projects/mailman/en/latest/src/mailman/rest/docs/listconf.html
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">process</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">mlist</span><span>, </span><span style="color:#bf616a;">msg</span><span>, </span><span style="color:#bf616a;">msgdata</span><span>):
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Add the Sender header to the email.&quot;&quot;&quot;
</span><span>        </span><span style="color:#65737e;"># Do not add already set headers, it would exist twice afterwards
</span><span>        </span><span style="color:#b48ead;">if </span><span>not &#39;</span><span style="color:#a3be8c;">Sender</span><span>&#39; in msg:
</span><span>            </span><span style="color:#65737e;"># Add the Sender header using the mailing list post address
</span><span>            msg[&#39;</span><span style="color:#a3be8c;">Sender</span><span>&#39;] = mlist.posting_address
</span><span>
</span><span>@</span><span style="color:#bf616a;">public
</span><span>@</span><span style="color:#bf616a;">implementer</span><span>(IHandler)
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">MailmanHeaderCleanerHandler</span><span style="color:#eff1f5;">:
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;A handler to edit the mailman headers for each email.&quot;&quot;&quot;
</span><span>
</span><span>    </span><span style="color:#65737e;"># The name of the handler should be unique.
</span><span>    name = &#39;</span><span style="color:#a3be8c;">mailman-headers-handler</span><span>&#39;
</span><span>    description = &#39;</span><span style="color:#a3be8c;">Edit the mailman header for emails.</span><span>&#39;
</span><span>
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">process</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">mlist</span><span>, </span><span style="color:#bf616a;">msg</span><span>, </span><span style="color:#bf616a;">msgdata</span><span>):
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Edit the mailman header for emails.&quot;&quot;&quot;
</span><span>        </span><span style="color:#65737e;"># Remove some headers
</span><span>        </span><span style="color:#b48ead;">del </span><span>msg[&#39;</span><span style="color:#a3be8c;">X-Mailman-Version</span><span>&#39;]
</span><span>        </span><span style="color:#b48ead;">del </span><span>msg[&#39;</span><span style="color:#a3be8c;">X-Mailman-Rule-Misses</span><span>&#39;]
</span><span>        </span><span style="color:#b48ead;">del </span><span>msg[&#39;</span><span style="color:#a3be8c;">X-Mailman-Rule-Hits</span><span>&#39;]
</span></code></pre>
<h2 id="finalize-the-setup">Finalize the setup</h2>
<p>You need to restart the mailman3 service: <code>service mailman3 restart</code>.
Then you can check everything is loaded by running <code>mailman shell</code> or <code>sudo -S -u lists-user mailman shell</code>:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">mailman</span><span> shell
</span><span style="color:#bf616a;">Welcome</span><span> to the GNU Mailman shell
</span><span>
</span><span>&gt;&gt;&gt; config.plugins
</span><span style="color:#bf616a;">{</span><span>&#39;</span><span style="color:#a3be8c;">mailman_sender_plugin</span><span>&#39;</span><span style="color:#bf616a;">: </span><span>&lt;mailman_sender_plugin.plugin.SenderHeaderPlugin object at 0xcafefffffff</span><span style="color:#d08770;">1</span><span>&gt;}
</span><span>&gt;&gt;&gt; config.handlers
</span><span style="color:#bf616a;">{</span><span>&#39;</span><span style="color:#a3be8c;">to-usenet</span><span>&#39;</span><span style="color:#bf616a;">:</span><span> ..., &#39;</span><span style="color:#a3be8c;">acknowledge</span><span>&#39;: ..., </span><span style="color:#b48ead;">[</span><span>...</span><span style="color:#b48ead;">]</span><span>, &#39;</span><span style="color:#a3be8c;">cleanse-dkim</span><span>&#39;: ..., &#39;</span><span style="color:#a3be8c;">mailman-sender-handler</span><span>&#39;: &lt;mailman_sender_plugin.handlers.handlers.SenderHeaderHandler object at 0xcafefffffff</span><span style="color:#d08770;">2</span><span>&gt;, &#39;</span><span style="color:#a3be8c;">mailman-headers-handler</span><span>&#39;: &lt;mailman_sender_plugin.handlers.handlers.MailmanHeaderCleanerHandler object at 0xcafefffffff</span><span style="color:#d08770;">3</span><span>&gt;}
</span><span>&gt;&gt;&gt; config.pipelines
</span><span style="color:#bf616a;">{</span><span>&#39;</span><span style="color:#a3be8c;">default-owner-pipeline</span><span>&#39;</span><span style="color:#bf616a;">: </span><span>&lt;mailman.pipelines.builtin.OwnerPipeline object at 0xcafefffffff</span><span style="color:#d08770;">4</span><span>&gt;, &#39;</span><span style="color:#a3be8c;">default-posting-pipeline</span><span>&#39;: &lt;mailman.pipelines.builtin.PostingPipeline object at 0xcafefffffff</span><span style="color:#d08770;">5</span><span>&gt;, &#39;</span><span style="color:#a3be8c;">virgin</span><span>&#39;: &lt;mailman.pipelines.virgin.VirginPipeline object at 0xcafefffffff</span><span style="color:#d08770;">6</span><span>&gt;, &#39;</span><span style="color:#a3be8c;">mail-sender-pipeline</span><span>&#39;: &lt;mailman_sender_plugin.pipelines.pipelines.MailSenderPipeline object at 0xcafefffffff</span><span style="color:#d08770;">7</span><span>&gt;}
</span></code></pre>
<h2 id="change-the-pipeline-in-the-mailing-list-settings">Change the pipeline in the mailing list settings</h2>
<p>Go to: "Settings" "Alter Messages " and change "Pipeline" to "mail-sender-pipeline".
The save the settings and send a test email to valide that all works fine.</p>
<p>Note: the HTML of the webpage was altered to only show the setting you need to change.</p>
<p><img src="../mailman3_settings_alter_messages.png" alt="mailman3 settings - alter messages" title="mailman3 settings - alter messages" /></p>
<h3 id="for-the-sender-header">For the Sender header</h3>
<p>You might want to set the "DMARC mitigation action" to none since you use a Sender header.</p>
<p>Go to: "Settings" &gt; "DMARC Mitigations" on the list and set "DMARC mitigation action" to "No DMARC mitigations".
This will stop changing the <code>From:</code> field of emails.</p>
<p>References:</p>
<ul>
<li><a rel="noopener" target="_blank" href="http://threebean.org/blog/plugins-for-mailman3/">Archive the contents to an API - threebean.org</a></li>
<li><a rel="noopener" target="_blank" href="https://github.com/TIM-JYU/mailman-rest-events">The mailman-rest-events plugin</a></li>
<li><a rel="noopener" target="_blank" href="https://gitlab.com/mailman/example-mailman-plugin/">The example plugin from mailman - mailman/example-mailman-plugin</a></li>
<li><a rel="noopener" target="_blank" href="https://lists.mailman3.org/archives/list/mailman-users@mailman3.org/thread/IQUAWUO6KG5KF47SV43IAVWA4T7BALRB/">adding personalized email header/content in mailman 3 - lists.mailman3.org</a></li>
<li><a rel="noopener" target="_blank" href="https://lists.mailman3.org/archives/list/mailman-users@mailman3.org/thread/EQ3GRZ42HPPJ72GKPUF5IVB5JM3WYUGV/">(Custom) Plugins: Proper file path(s) for adding a handler? - lists.mailman3.org</a></li>
</ul>
</div>
    <footer class="post-footer">
        
        <ul class="post-tags">
        
            <li><a href="https://blog.williamdes.eu/tags/infra-tutorial/">infra-tutorial</a></li>
        
            <li><a href="https://blog.williamdes.eu/tags/mailman3/">mailman3</a></li>
        
        </ul>
        
    </footer>
</article>

        </main>

        <footer class="footer">
            <span>&copy; 2021-2025 <a href="https://blog.williamdes.eu">Williamdes&#x27;s blog</a></span>
            <span>&middot;</span>
            <span>Powered by <a href="https://www.getzola.org" rel="noopener" target="_blank">Zola</a></span>
            <span>&middot;</span>
            <span>Theme <a href="https://github.com/schoenenberg/zola-paper" rel="noopener" target="_blank">Zola-Paper</a></span>
            <br>
            <span><a href="https://github.com/wdesportes/blog.williamdes.eu" rel="noopener" target="_blank">Source code on GitHub</a></span>
            <span>&middot;</span>
            <span><a href="https://github.com/wdesportes/blog.williamdes.eu/discussions" rel="noopener" target="_blank">Found a bug ?</a></span>
            <span>&middot;</span>
            <span><a href="https://williamdes.eu" rel="noopener" target="_blank">Visit my personal website</a></span>
            <span>&middot;</span>
            <span><a href="https://blog.williamdes.eu/atom.xml" rel="noopener" target="_blank" type="application/rss+xml">RSS feed</a></span>
            <br>
            <span>If you are searching for cookies, this is not a bakery website ^^</span>
        </footer>
    
    </body>
</html>
