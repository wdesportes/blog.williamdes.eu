<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Williamdes&#x27;s blog - A new uptime service for my infrastructure (upptime)</title>

        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">

        <!-- Enable responsiveness on mobile devices-->
        <!-- viewport-fit=cover is to support iPhone X rounded corners and notch in landscape-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

        <!-- Standard meta tags -->
        <meta name="author" content="William Desportes">
        <meta name="description" content="Here is the story of why I did move from my &lt;a rel=&quot;noopener&quot; target=&quot;_blank&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wdes&#x2F;stats&quot;&gt;custom made&lt;&#x2F;a&gt; &lt;a rel=&quot;noopener&quot; target=&quot;_blank&quot; href=&quot;https:&#x2F;&#x2F;heroku.com&quot;&gt;Heroku&lt;&#x2F;a&gt;&#x2F;Node&#x2F;&lt;a rel=&quot;noopener&quot; target=&quot;_blank&quot; href=&quot;https:&#x2F;&#x2F;www.typescriptlang.org&#x2F;&quot;&gt;TypeScript&lt;&#x2F;a&gt; stats service to &lt;a rel=&quot;noopener&quot; target=&quot;_blank&quot; href=&quot;https:&#x2F;&#x2F;upptime.js.org&#x2F;&quot;&gt;upptime&lt;&#x2F;a&gt;.">

        <!-- Open Graph Tags -->
        <meta property="og:site_name" content="Williamdes&#x27;s blog">
        
        <meta property="og:title" content="A new uptime service for my infrastructure (upptime)">
        <meta property="og:url" content="https://blog.williamdes.eu/OpenSource/stories/moving-my-uptime-service-to-upptime">
        <meta property="og:description" content="Here is the story of why I did move from my &lt;a rel=&quot;noopener&quot; target=&quot;_blank&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;wdes&#x2F;stats&quot;&gt;custom made&lt;&#x2F;a&gt; &lt;a rel=&quot;noopener&quot; target=&quot;_blank&quot; href=&quot;https:&#x2F;&#x2F;heroku.com&quot;&gt;Heroku&lt;&#x2F;a&gt;&#x2F;Node&#x2F;&lt;a rel=&quot;noopener&quot; target=&quot;_blank&quot; href=&quot;https:&#x2F;&#x2F;www.typescriptlang.org&#x2F;&quot;&gt;TypeScript&lt;&#x2F;a&gt; stats service to &lt;a rel=&quot;noopener&quot; target=&quot;_blank&quot; href=&quot;https:&#x2F;&#x2F;upptime.js.org&#x2F;&quot;&gt;upptime&lt;&#x2F;a&gt;.">
        
        <meta property="og:type" content="article">
        <meta property="article:published_time" content="2021-02-03">
        <meta property="article:modified_time" content="2021-02-24">
        
        <meta property="article:tags" content="OSS-story">
        

        <!-- CSS -->
        <link rel="stylesheet" href="https://blog.williamdes.eu/main.css">

        <!-- Feeds -->
        <link rel="alternate" type="application/atom+xml" title="RSS" href="https://blog.williamdes.eu/atom.xml">

        <script>
            function setTheme() {
                const time = new Date();

                const prev = localStorage.getItem('date');
                const date = String(time.getMonth() + 1) + '.' + String(time.getDate());

                const now = time.getTime();
                let sunrise;
                let sunset;

                function setBodyClass() {
                    if (now > sunrise && now < sunset) return;
                    document.body.classList.add('dark');
                }

                if (date !== prev) {
                    fetch('https://api.ipgeolocation.io/astronomy?apiKey=f96ef8fc7d8247deae9022b4cedd6f97')
                        .then(res => res.json())
                        .then(data => {
                            sunrise = data.sunrise.split(':').map(Number);
                            sunset = data.sunset.split(':').map(Number);
                    })
                    .catch(() => {
                        sunrise = [7, 0];
                        sunset = [19, 0];
                    })
                    .finally(() => {
                        sunrise = time.setHours(sunrise[0], sunrise[1], 0);
                        sunset = time.setHours(sunset[0], sunset[1], 0);
                        setBodyClass();
                        localStorage.setItem('sunrise', sunrise);
                        localStorage.setItem('sunset', sunset);
                    });
                    localStorage.setItem('date', date);
                } else {
                    sunrise = Number(localStorage.getItem('sunrise'));
                    sunset = Number(localStorage.getItem('sunset'));
                    setBodyClass();
                }
            }
        </script>
        <!-- Matomo -->
        <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="//analytics.datacenters.network/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '1']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
        })();
        </script>
        <noscript><p><img src="//analytics.datacenters.network/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt="" /></p></noscript>
        <!-- End Matomo Code -->
    </head>

    <body class="single">

    <!-- Apply theme -->
    <script>
      setTheme();
    </script>

    
        <header class="header">
            <nav class="nav">
                
                <p class="logo"><a href="https://blog.williamdes.eu">Williamdes&#x27;s blog</a></p>
                
                <ul class="menu">
                    
                </ul>
            </nav>
        </header>

        <main class="main">
            
<article class="post-single">
    <header class="post-header">
        <h1 class="post-title">A new uptime service for my infrastructure (upptime)</h1>
        <div class="post-meta">
            <span class="post-author">
                Author: William Desportes
            </span>
            <br/>
            <span class="post-date">Published: <time datetime="2021-02-03T15:00:00+0000">February  3, 2021 15:00</time></span>
            <span class="post-date"> and updated: <time datetime="2021-02-24T17:10:00+0000">February 24, 2021 17:10</time></span>
            <span>&middot;</span>
            <span class="post-reading-time">3 min read</span>
        </div>
    </header>
    <div class="post-content"><p>Here is the story of why I did move from my <a rel="noopener" target="_blank" href="https://github.com/wdes/stats">custom made</a> <a rel="noopener" target="_blank" href="https://heroku.com">Heroku</a>/Node/<a rel="noopener" target="_blank" href="https://www.typescriptlang.org/">TypeScript</a> stats service to <a rel="noopener" target="_blank" href="https://upptime.js.org/">upptime</a>.</p>
<span id="continue-reading"></span><h2 id="some-story">Some story</h2>
<p>Since 2018 I have been using and maintaining my service to monitor my different websites.
My first deploy was on July 2018 and the last one in February 2021, since 2018 I have been maintaining and improving the service.
I flushed the data once and since 2019-02-01 it has been collecting status codes and response times.
Actually 1571311 * 2 rows of data, no downtime. Thank you <a rel="noopener" target="_blank" href="https://heroku.com">Heroku</a> !</p>
<p>Conclusion: this service I built worked quite well and was ugly. I did receive sms notifications when things got up or down.
I am moving to <a rel="noopener" target="_blank" href="https://upptime.js.org/">upptime</a> because it is free, open-source and maintained. And has a very cool UI !</p>
<h2 id="technical-side">Technical side</h2>
<p>You can find the source code: <a rel="noopener" target="_blank" href="https://github.com/wdes/stats">here</a></p>
<p>I used <a rel="noopener" target="_blank" href="https://www.typescriptlang.org/">TypeScript</a> over NodeJS with <a rel="noopener" target="_blank" href="https://sequelize.org/">Sequelize</a> as an ORM and migration system.
Also used <a rel="noopener" target="_blank" href="https://www.npmjs.com/package/node-cron">node-cron</a> to make my scheduling work and <a rel="noopener" target="_blank" href="https://www.npmjs.com/package/twig">twig</a> for my templates. And for API docs I used the <a rel="noopener" target="_blank" href="https://www.npmjs.com/package/apidoc">apidoc</a> package that works great.</p>
<p>I was quite pleased about this project and the modules I used, very rarely had bugs.</p>
<h2 id="hacky-side">Hacky side</h2>
<p>I had to prevent the Dyno from sleeping by feeding it requests every 5 minutes using <a rel="noopener" target="_blank" href="https://uptimerobot.com/">Uptime Robot</a>.
It is a great tool and I recommend it but having paid features was not for me, so I only kept one for the dyno and built the wdes-stats service.</p>
<h2 id="costs-side">Costs side</h2>
<p>Total project costs: 0$, 31 months of free Dyno time. Databases for free too.</p>
<h2 id="backups">Backups</h2>
<p>What are you talking about ?? ^^. More seriously I designed a backup button but I never could work because pulling all the data (1.5M rows)was complex on a Dyno and the buffer was quite large and could not handle to keep the data in memory to send it to be my email.
Conclusion: it works on my workstation, not in production.</p>
<h2 id="screenshots-of-the-old-service">Screenshots of the old service</h2>
<h3 id="the-homepage">The homepage</h3>
<p><img src="../screenshots/Accueil__wdes-stats___210203_004.jpg" alt="The wdes-stats homepage" title="The wdes-stats homepage" /></p>
<h3 id="the-admin-welcome">The admin welcome</h3>
<p>(After a GitHub login)</p>
<p><img src="../screenshots/Administration___wdes-stats___210203_002.jpg" alt="The wdes-stats admin welcome" title="The wdes-stats admin welcome" /></p>
<h3 id="the-servers-list">The servers list</h3>
<p>(with a enable/disable button)</p>
<p><img src="../screenshots/Administration___Serveurs___wdes-stats___210203_003.jpg" alt="The wdes-stats servers list" title="The wdes-stats servers list" /></p>
<h3 id="a-time-stats-page">A time stats page</h3>
<p>(with a pie chart of the status codes)</p>
<p><img src="../screenshots/Statistiques_de_temps_du_serveur__wdes-stats___210203_005.jpg" alt="The wdes-stats time stats page" title="The wdes-stats time stats page" /></p>
<h2 id="mirating-to-the-new-service">Mirating to the new service</h2>
<p>I did follow the <a rel="noopener" target="_blank" href="https://upptime.js.org/docs/get-started">manual</a> and that was it !
Here it is: <a rel="noopener" target="_blank" href="https://status.datacenters.network/">https://status.datacenters.network/</a></p>
<p>(did I choose to keep the watermarks, absolutely !)</p>
<h2 id="screenshots">Screenshots</h2>
<h3 id="the-homepage-1">The homepage</h3>
<p><img src="../screenshots/Home_status_Datacenters_network_210203_007.jpg" alt="The status upptime homepage" title="The upptime homepage" /></p>
<h3 id="a-time-stats-page-1">A time stats page</h3>
<p>(yes, it says it is down and <del>I do not know why for now</del> this is because if you use a custom commit template you can break the parsing, see the issue for that: <a rel="noopener" target="_blank" href="https://github.com/upptime/upptime/issues/268">here</a>)</p>
<p><img src="../screenshots/Server_stats_status_Datacenters_network_210203_008.jpg" alt="The upptime time stats page" title="The upptime time stats page" /></p>
</div>
    <footer class="post-footer">
        
        <ul class="post-tags">
        
            <li><a href="https://blog.williamdes.eu/tags/oss-story/">OSS-story</a></li>
        
        </ul>
        
    </footer>
</article>

        </main>

        <footer class="footer">
            <span>&copy; 2022 <a href="https://blog.williamdes.eu">Williamdes&#x27;s blog</a></span>
            <span>&middot;</span>
            <span>Powered by <a href="https://www.getzola.org" rel="noopener" target="_blank">Zola</a>️</span>
            <span>&middot;</span>
            <span>Theme️ <a href="https://github.com/schoenenberg/zola-paper" rel="noopener" target="_blank">Zola-Paper</a></span>
            <span>&middot;</span>
            <span>Visit <a href="https://williamdes.eu" rel="noopener" target="_blank">my personal website</a></span>
            <span>&middot;</span>
            <span><a href="https://blog.williamdes.eu/atom.xml" rel="noopener" target="_blank" type="application/rss+xml">RSS feed</a></span>
            <br>
            <span>If you are searching for cookies, this is not a bakery website ^^</span>
        </footer>
    
    </body>
</html>
